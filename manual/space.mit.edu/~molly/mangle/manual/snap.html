<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
 "http://www.w3.org/TR/REC-html40/loose.dtd">

<html>
<head>
  <title>mangle : manual : commands</title>
  <meta http-equiv="Content-Type" content="text/html">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <meta name="description"
  content="mangle: a code to compute the spherical harmonics of an arbitrary angular mask.">
  <meta name="keywords"
  content="mangle, spherical harmonics, Large Scale Structure, Cosmic Microwave Background">
  <link href="../style/mangle_template.css" rel="stylesheet" type="text/css">
  
</head>
<body>

<div class="main">

<div class="title">
</div>

<div class="nav clear">

<ul class="menu centered">
    <li><a href="../">Overview</a></li>
    <li><a href="../download/">Download</a></li>
    <li><a href="../quickstart/">QuickStart</a></li>
    <li><a href="./">Manual</a></li>
    <li><a href="../references/">References</a></li>
</ul>

</div>

<br>

<div class="pagetitlebox">
<div class="pagetitle">
<img src="./manual.png" alt="manual">
</div>
<div class="pagesubtitle">
<h5>Commands</h5><!--img src="./commands.png" alt="commands" style="margin-left: 182.5px;"-->
</div>
</div>

<div class="contentbox">
<div class="submenu" style="width: 153px;">
<ul>
    <li><a href="./">Terms</a></li>
    <li><a href="./commands.html">Commands</a></li>
    <li><a href="./polyformat.html">Polygon Formats</a></li>
    <li class="last"><a href="./troubleshooting.html">Troubleshooting</a></li>
</ul>
</div>
<div class="content">
<p style="margin-left: 193px;"><br></p>
<h2>snap</h2>
<p style="margin-left: 193px;"><tt>snap</tt>
identifies almost coincident cap boundaries and snaps them together.
<br><br>
<tt>
snap [-d] [-q] [-S] [-a&lt;a&gt;[u]] [-b&lt;a&gt;[u]] [-t&lt;a&gt;[u]] [-y&lt;r&gt;] [-m&lt;a&gt;[u]] [-s&lt;n&gt;] [-e&lt;n&gt;]
[-vo|-vn|-vp] [-p[+|-]&lt;n&gt;] [-i&lt;f&gt;[&lt;n&gt;][u]] [-o&lt;f&gt;[u]] polygon_infile1 [polygon_infile2 ...] polygon_outfile
</tt>
<br><br>
You should always start by running
<tt>snap</tt>
on all the original files that define your mask.
If you have several original files,
then you should also run <tt>snap</tt> on the combined output.
If you do not run <tt>snap</tt>, then you are asking for trouble,
and you can email complaints to /dev/null.  (Note: it is okay to run 
<tt>pixelize</tt> before running <tt>snap</tt> if you want to speed
up the snapping.)
<br><br>
The problem is that
the positions of the intersections of two almost but not exactly coincident
circles (cap boundaries) on the unit sphere may be subject to significant
numerical uncertainty.
To avoid numerical problems, such circles must be made exactly coincident,
and <tt>snap</tt> does just that.
You might think that that near-but-not-exactly-coincident circles
would hardly ever happen, but in practice they occur often,
because a mask designer tries to make two polygons abut,
but imprecision or numerical round-off defeats an exact abutment.
<br><br>
Snap adjusts the edges of each polygon,
but it leaves the number and order of polygons
the same as in the input file(s).
Edges that appear later in the input file(s) are snapped to earlier edges.
<br><br>
Here for example is the incantation for the 2QZ&#160;10k&#160;North survey
(my private convention is to begin all junk files with a j):
</p>
<p style="margin-left: 233px;">
<tt>
	snap -ir1r -a2s -b2s -t2s -m1e-5 ngp_ukstfld.lims.txt jnu<br>
	snap -ic1h -s6 -a2s -b2s -t2s -m1e-5 ngp_field_coords.txt jnf<br>
	snap -iv4r -a2s -b2s -t2s -m1e-5 ngp.used.rahole.txt jnh<br>
	snap -a2s -b2s -t2s -m1e-5 jnu jnf jnh jnufh
</tt>
</p>
<p style="margin-left: 193px;">
The first three <tt>snap</tt> commands snap the cap boundaries
of each of the three original mask files.
The fourth <tt>snap</tt> snaps the combined set of cap boundaries.
The <tt>-i..</tt> switches specify the
<a href="./polyformat.html">format</a> of the input polygon files.
The <tt>-i..</tt> switches can be omitted
if each polygon file is prefaced with a few lines containing
<a href="./inputkeywords.html">keywords</a>
with appropriate parameters that specify the format.
<br><br>
The <tt>snap</tt>
command offers four tunable tolerances
</p>
<p style="margin-left: 233px;">
<tt>
	snap -a&lt;angle&gt;[&lt;unit&gt;] -b&lt;angle&gt;[&lt;unit&gt;] -t&lt;angle&gt;[&lt;unit&gt;] -y&lt;ratio&gt; ...

</tt>
</p>
<p style="margin-left: 193px;">
The various <tt>&lt;angle&gt;</tt>s and <tt>ratio</tt> are real numbers,
while <tt>[&lt;unit&gt;]</tt> is an optional angular unit,
one of
<tt>r</tt> (radians),
<tt>d</tt> (degrees),
<tt>m</tt> (arcminutes),
<tt>s</tt> (arcseconds),
or
<tt>h</tt> (Right Ascension in hours, minutes, and seconds,
Declination in degrees, arcminutes, and arcseconds).
You can find out what the defaults are with
</p>
<p style="margin-left: 233px;">
<tt>
	snap -d
</tt>
</p>
<p style="margin-left: 193px;">
In mangle 2.1,
the default <tt>angle</tt>s are all 2x10<sup>-9</sup> arcseconds for the real*10 version
and 2x10<sup>-5</sup> arcseconds for the real*8 version,
while the default value of <tt>ratio</tt> is <tt>0.01</tt>.
<br><br>
These default values are appropriate for the SDSS survey.  If the boundaries of your 
survey are less precisely defined than SDSS, e.g., older surveys such as 2QZ, you should use larger tolerance angles. The 2QZ example above uses <tt>2s</tt> for the value of the <tt>angle</tt>s, which is 2 arcseconds. (The default value of <tt>ratio</tt>,
the argument of the <tt>-y</tt> switch,
should be fine in virtually all cases.)
<br><br>
<tt>snap</tt>
accomplishes its work in two stages:
<br>
</p>
<ul style="list-style-type: none; margin-left: 193px;">
    <li>Stage 1: Snap axes and latitudes of pairs of caps together,
        passing repeatedly through all pairs of caps until no more caps are snapped.<br><br></li>
    <li>Stage 2: Snap edges of polygons to other edges,
        again passing repeatedly through all pairs of caps until no more caps are snapped.</li>
</ul>
<a name="snaptable"></a>
<center>
<table bgcolor="#f6eecc" cellpadding=2 border=0 style="margin-left: 193px;">
<tr><td>
<table cellspacing=2 cellpadding=4 border=1>

<tr><td valign=top>
<tt>
-S
</tt>
</td><td valign=top>
self-snap
</td><td valign=top>
Snap only edges belonging to the same polygon,
not edges of different polygons.
</td></tr>

<tr><td valign=top>
<tt>

-a&lt;angle&gt;[&lt;unit&gt;]
</tt>
</td><td valign=top>
axis tolerance
</td><td valign=top>
Are the axes of two caps within
<tt>&lt;angle&gt;</tt>
of each other, either parallel or anti-parallel?
If so, change the axis of the second cap to equal that of the first cap.
</td></tr>

<tr><td valign=top>
<tt>

-b&lt;angle&gt;[&lt;unit&gt;]
</tt>
</td><td valign=top>
latitude tolerance
</td><td valign=top>
If the axes of two caps coincide,
are their latitude boundaries within
<tt>&lt;angle&gt;</tt>
of each other?
If so, change the latitude of the second cap to equal that of the first cap.
The two caps may lie either on the same or on opposite sides of the latitude
boundary.
</td></tr>

<tr><td valign=top>
<tt>

-t&lt;angle&gt;[&lt;unit&gt;]
</tt>
</td><td valign=top>
edge tolerance
</td><td rowspan=2 valign=top>
Are the two endpoints and midpoint of an edge
closer to a cap boundary than the lesser of
(1)&#160;<tt>&lt;angle&gt;</tt>,
and
(2)&#160;<tt>&lt;ratio&gt;</tt> times the length of the edge?
In addition,
does at least one of the two endpoints or midpoint of the edge
lie inside all other caps of the polygon that owns the cap boundary?
If so,
change the edge to align with the cap boundary.
</td></tr>

<tr><td valign=top>
<tt>
-y&lt;ratio&gt;
</tt>
</td><td valign=top>
edge to length tolerance
</td></tr>

</table>
</td></tr>
</table>
</center>

<p style="margin-left: 193px;">
Back to <a href="./commands.html">list of commands</a>.
</p>

</div>
</div>

<div class="footer">
<a href="http://www.colorado.edu"><div class="footerleft">
<img src="../CU.jpg" alt="CU">
</div>
</a>
<a href="http://space.mit.edu"><div class="footerright2">
<img src="../mki.jpg" alt="MKI">
</div>
</a>
<a href="http://web.mit.edu"><div class="footerright1">
<img src="../mit.gif" alt="MIT">
</div>
</a>
</div>

</div>
</body>
</html>
